---
title: "DATS6101 Project 1 summarized"
author: "Sayra Moore, Andrea Piolini, Sabina Shahbazzade, Caroline Sklaver, Spencer Staub"
date: "10/13/2019"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
```

```{r read, echo=FALSE, include = TRUE}
setwd('/Users/carolinesklaver/Desktop/Intro_DS/Project 1')
athlete_events = read.csv("athlete_events.csv")
str(athlete_events)
```

```{r NAs, echo=FALSE}
# omitting NAs leaves only athletes that won medals
summer_events = na.omit(athlete_events[athlete_events$Season == 'Summer',])

# keeping NAs for analysis of winners and losers
summer_w_NAs = athlete_events[athlete_events$Season=='Summer',]

```

## Introduction

Some writing on background, project 1 findings, new SMART questions...

## Descriptive Statistics (graphs we will be using from Proj1 in Proj2)

### Medals


```{r Number Mean Medals, echo=FALSE, include=FALSE}
#Total Number of Summer Games
unique_games = unique(summer_w_NAs$Games)
length(unique_games)

# Medals per country
medals_table = table(summer_events$Medal,summer_events$NOC)
mean(medals_table)

```


```{r Medals by country barplot, echo=FALSE, include=TRUE}
# stacked barplot of medals won by top countries
subset_medals = medals_table[,c('USA', 'URS', 'GBR', 'GER', 'ITA', 'FRA', 'AUS',
                                'CHN','HUN','JPN','NED','RUS','SWE')]
barplot(subset_medals, main = "Total medals won by country", 
        ylab = 'Country Code', xlab = "Number of medals won", col = c('gold', 'light gray','gold4'),
        legend.text = c("Gold",'Silver','Bronze'), horiz = TRUE, las=2)
```


### Participation M/F over time & by Participation by sport (total)

```{r , echo=FALSE, include=TRUE}
# participants over time
athlete_events_MPC = summer_w_NAs %>% group_by(Year) %>% summarise(count = n_distinct(Team))
ggplot(data=athlete_events_MPC, aes(x=Year, y=count)) +
  geom_line()+
  geom_point() + ggtitle('Number of Olympic athletes over time') + ylab('Number of participants')


# plot male female participants over time
group_count_mf <- summer_w_NAs %>% group_by(Year, Sex) %>%
  summarize(Athletes = length(unique(ID)))
group_count_mf$Year <- as.integer(group_count_mf$Year)

ggplot(group_count_mf, aes(x=Year, y=Athletes, group=Sex, color=Sex)) +
  geom_point(size=2) +
  geom_line()  +
  scale_color_manual(values=c("deeppink1","dodgerblue1")) +
  labs(title = "Number of male and female Olympic Athletes over time") +
  theme(plot.title = element_text(hjust = 0.5))


# total participation by sport
sport_participation = sort(table(summer_w_NAs$Sport), decreasing = TRUE)
barplot(sport_participation[2:20], las=2, main="Total Atheletes by Sport", col = 'gray78')

# male and female by sport
female_w_NAs = summer_w_NAs[summer_w_NAs$Sex == 'F',]
male_w_NAs = summer_w_NAs[summer_w_NAs$Sex == 'M',]

female_sport_participation = sort(table(female_w_NAs$Sport), decreasing = TRUE)
male_sport_participation = sort(table(male_w_NAs$Sport), decreasing = TRUE)


barplot(female_sport_participation[2:10], las=2, main="Number of Female Athletes by Sport", col = 'deeppink1',
        ylim = c(0,18000))
barplot(male_sport_participation[2:10], las=2, main="Number of Male Athletes by Sport", col='dodgerblue1',
        ylim = c(0,18000))

```


### Age, Height, Weight

Histograms to view the distribution of Age, Height, and Weight for all Olympic Athletes. This is useful to determine the distribution. Age and weight are a bit right-skewed, height is very normal. These distributions do not vary greatly when looking at males and females separately. 

```{r histograms, echo=FALSE, include=TRUE}
# Descriptive stats of Age, Height, Weight

par(mfrow=c(1,3))

hist(summer_w_NAs$Age, breaks = 30, main = 'Histogram of Age', xlab = 'Age', ylab = 'Frequency', col = 'rosybrown1')
#hist(f$Age, breaks = 30)
#hist(m$Age, breaks = 30)

hist(summer_w_NAs$Height, breaks = 30, main = 'Histogram of Height',xlab = 'Height(cm)', ylab = 'Frequency', col = 'darkseagreen3')
#hist(f$Height, breaks = 30)
#hist(m$Height, breaks = 30)

hist(summer_w_NAs$Weight, breaks = 30, main = 'Histogram of Weight',xlab = 'Weight(kg)', ylab = 'Frequency', col = 'lightblue3')
#hist(f$Weight, breaks = 30)
#hist(m$Weight, breaks = 30)

```

Correlations between age, height, and weight, also represented in graphics. Height and weight are highly correlated (0.7951830). 

```{r AHW Correlations, echo=FALSE, include=TRUE}
# Corrrelations between age, height, weight
corr_col = cor(na.omit(summer_w_NAs[c(4,5,6)]))
corr_col
library(corrplot)
corrplot(corr_col, method = "circle")

```


## Statistical Tests from Project 1

```{r}
# differenciate between winners and losers
# THIS IS VERY IMPORTANT PART OF THE CODE
summer_w_NAs <- subset(athlete_events, Season == 'Summer')
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[is.na(summer_w_NAs$Medal)] <- "Loser"
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Bronze'] <- 'Winner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Silver'] <- 'Winner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Gold'] <- 'Winner'
```


### Does age, height, or weight determine outcome (winning of medals)? We may not need this anymore (kinda dumb to make it categorical he said)

Chi-squared

```{r Chi-Squraed, echo=FALSE, include=TRUE}
# Chi Squared: Does age, height, or weight determine if you won a medal or not

# differenciate between winners and losers
summer_w_NAs <- subset(athlete_events, Season == 'Summer')
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[is.na(summer_w_NAs$Medal)] <- "Loser"
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Bronze'] <- 'Winner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Silver'] <- 'Winner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Gold'] <- 'Winner'

# make age/height/weight categorical
summary(summer_w_NAs$Age)
summer_w_NAs$Cat_Age = summer_w_NAs$Age
summer_w_NAs$Cat_Age = replace(summer_w_NAs$Cat_Age, summer_w_NAs$Cat_Age >= 28, 'old')
summer_w_NAs$Cat_Age = replace(summer_w_NAs$Cat_Age, summer_w_NAs$Cat_Age<=21, 'young')
summer_w_NAs$Cat_Age = replace(summer_w_NAs$Cat_Age, 
                               summer_w_NAs$Cat_Age > 21 & summer_w_NAs$Cat_Age < 28, 'avg')


summary(summer_w_NAs$Height)
summer_w_NAs$Cat_Height = summer_w_NAs$Height
summer_w_NAs$Cat_Height = replace(summer_w_NAs$Cat_Height, summer_w_NAs$Cat_Height >= 183, 'tall')
summer_w_NAs$Cat_Height = replace(summer_w_NAs$Cat_Height, summer_w_NAs$Cat_Height<=168, 'short')
summer_w_NAs$Cat_Height = replace(summer_w_NAs$Cat_Height, 
                               summer_w_NAs$Cat_Height > 168 & summer_w_NAs$Cat_Height < 183, 'avg')


summary(summer_w_NAs$Weight)
summer_w_NAs$Cat_Weight = summer_w_NAs$Weight
summer_w_NAs$Cat_Weight = replace(summer_w_NAs$Cat_Weight, summer_w_NAs$Cat_Weight >= 79, 'heavy')
summer_w_NAs$Cat_Weight = replace(summer_w_NAs$Cat_Weight, summer_w_NAs$Cat_Weight<=60, 'light')
summer_w_NAs$Cat_Weight = replace(summer_w_NAs$Cat_Weight, 
                               summer_w_NAs$Cat_Weight > 60 & summer_w_NAs$Cat_Weight < 79, 'avg')



cont_age_medal_w_na <- table(summer_w_NAs$Cat_Age, summer_w_NAs$Medal)
chitest4 = chisq.test(cont_age_medal_w_na)
chitest4


cont_height_medal_w_na <- table(summer_w_NAs$Cat_Height, summer_w_NAs$Medal)
chitest5 = chisq.test(cont_height_medal_w_na)
chitest5


cont_weight_medal_w_na <- table(summer_w_NAs$Cat_Weight, summer_w_NAs$Medal)
chitest6 = chisq.test(cont_weight_medal_w_na)
chitest6

```


### Does the average age vary between men and women?

2-sample t-test

```{r ttest, echo=FALSE, include = TRUE}
# 2-Sample T-Test
summer_w_NAs = na.omit(summer_w_NAs, Age)
m=subset(summer_w_NAs, Sex=='M')
f=subset(summer_w_NAs, Sex=='F')
mean(m$Age)
mean(f$Age)

t = t.test(m$Age,f$Age, alternative = "two.sided", var.equal = FALSE)
t
```

### Does age, height, and weight significantly change over the years?

ANOVA

```{r ANOVA, echo=FALSE, include = TRUE}
# ANOVA - does mean height statistically change over the years
summer_w_NAs = na.omit(summer_w_NAs, Age)
summer_w_NAs$Year = as.factor(summer_w_NAs$Year)
male_aov = summer_w_NAs[summer_w_NAs$Sex == 'M',]
female_aov = summer_w_NAs[summer_w_NAs$Sex == 'F',]

library(RColorBrewer)
# ANOVA for Height
# Male
aov_m_height = aov(Height~Year, data=male_aov)
summary(aov_m_height)
# Female
aov_f_height = aov(Height~Year, data=female_aov)
summary(aov_f_height)

plot(Height~Year, data=male_aov, col = terrain.colors(29), main = 'Mean Male Height per Year', ylim=c(130,220))
plot(Height~Year, data=female_aov, col = terrain.colors(29), main = 'Mean Female Height per Year', ylim=c(130,220))

# ANOVA for Age
aov_m_age = aov(Age~Year, data=male_aov)
summary(aov_m_age)
# Female
aov_f_age = aov(Age~Year, data=female_aov)
summary(aov_f_age)

plot(Age~Year, data=male_aov, col = terrain.colors(29), main = 'Mean Male Age per Year')
plot(Age~Year, data=female_aov, col = terrain.colors(29), main = 'Mean Female Age per Year')

# ANOVA for Weight
aov_m_weight = aov(Weight~Year, data=male_aov)
summary(aov_m_weight)
# Female
aov_f_weight = aov(Weight~Year, data=female_aov)
summary(aov_f_weight)

plot(Weight~Year, data=male_aov, col = terrain.colors(29), main = 'Mean Male Weight per Year', ylim = c(20,150))
plot(Weight~Year, data=female_aov, col = terrain.colors(29), main = 'Mean Female Weight per Year', ylim = c(20,150))
```

```{r tukeyHSD, echo= FALSE, include=FALSE}
tukey_f_height <- TukeyHSD(aov_f_height)
tukey_f_height
tukey_m_height <- TukeyHSD(aov_m_height)
tukey_m_height
tukey_f_age <- TukeyHSD(aov_f_age)
tukey_f_age
tukey_m_age <- TukeyHSD(aov_m_age)
tukey_m_age
tukey_f_weight <- TukeyHSD(aov_f_weight)
tukey_f_weight
tukey_m_weight <- TukeyHSD(aov_m_height)
tukey_m_weight
```



