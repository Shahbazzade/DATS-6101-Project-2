# CHAPTER 3: SMART QUESTION II
## 3.1 Does age, height, and weight determine whether an athlete wins an olympic medal?

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
library(forcats)
library(plyr)
library(devtools)
library(corrplot)

# can add quietly=T option to the require() function
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }
```

```{r read, echo=FALSE, include =FALSE}
setwd('/Users/carolinesklaver/Desktop/Intro_DS/Project 1')
athlete_events = read.csv("athlete_events.csv")
```

```{r NAs, echo=FALSE, include=FALSE}
# omitting NAs leaves only athletes that won medals
summer_events = na.omit(athlete_events[athlete_events$Season == 'Summer',])

# keeping NAs for analysis of winners and losers
summer_w_NAs = athlete_events[athlete_events$Season=='Summer',]

# omit NAs
summer_w_NAs = na.omit(summer_w_NAs, Age)
```

### 3.1.1 Correlations

Correlations between age, height, and weight, also represented in graphics. Height and weight are quite highly correlated (0.7951830). This is intuitive across most populations, taller individuals are also heavier.  

```{r AHW Correlations, echo=FALSE, include=TRUE}
# Corrrelations between age, height, weight
corr_col = cor(na.omit(summer_w_NAs[c(4,5,6)]))
corrplot(corr_col, method = "circle")

# Plot the relationship between height and weight
ggplot(summer_w_NAs, aes(x=Weight, y=Height,, color=Sex)) +
  geom_point(size=0.5)+
  geom_smooth(method=glm)+
  ggtitle("Weight vs. Height for all Olympic Athletes")+
  xlab('Weight(kg)')+ ylab("Height(cm)")+ xlim(0,175)+
  scale_color_manual(values=c('deeppink2','royalblue'))
```


```{r winner loser, include=FALSE}
# differenciate between winners and losers
# THIS IS VERY IMPORTANT PART OF THE CODE
summer_w_NAs <- subset(athlete_events, Season == 'Summer')
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[is.na(summer_w_NAs$Medal)] <- "Loser"

# made it 'a' in the beginning so that in the boxplots it is the one on the left
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Bronze'] <- 'aWinner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Silver'] <- 'aWinner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Gold'] <- 'aWinner'

# make sure Medal is as factor
summer_w_NAs$Medal = as.factor(summer_w_NAs$Medal)
```


### 3.1.2 Does the average Age, Height, or Weight different between olympic medalists and non-medalists?

In order to determine whether age, height and weight differ between medalists and non-medalists, we have performed two-sample t-tests with the groups being athletes that have won a medal and athletes that have not won a medal. These tests were performed on male and female athlete populations separately because in our previous analysis from Project 1, we found that the mean age, height, and weight of males significantly differs from that of females (two-sample t-test). 

```{r Split M/F, echo=FALSE}
# omit NAs
summer_w_NAs = na.omit(summer_w_NAs, Age)

# separate males and females
summer_F = summer_w_NAs[summer_w_NAs$Sex == 'F',]
summer_M = summer_w_NAs[summer_w_NAs$Sex == 'M',]

# separate winners and losers
F.Winner = summer_F[summer_F$Medal == 'aWinner',]
F.Loser = summer_F[summer_F$Medal == 'Loser',]

M.Winner = summer_M[summer_M$Medal == 'aWinner',]
M.Loser = summer_M[summer_M$Medal == 'Loser',]

```


### 3.1.3 T-Test Resluts

The average age of female medalists is 24.25, while the average age of female non-medalists is 23.50 with a p-value < 0.05. The mean height for female medalists is 171.15cm, while that of non-medalists 167.61cm with a significant p-value. The mean weight for female medalists is 63.58kg, while that of non-medalists is 59.41 with a significant p-value. For each of these two-sample t-tests, we were able to reject the null hypotheses and conclude that the average age, height and weight for female olympic medalists signficantly differs from that of female olympic non-medalists. In this case, we can see that the means are higher for all three categories, such that the female medalists are, on average, older, taller, and heavier than non-medalists.   

According to the male age two-sample t-test, the average age of male medalists (25.77) does not significantly differ from that of non-medalists (25.67). However, the mean height for male medalists is 181.61cm, while that of non-medalists is 178.57 with a significant p-value. The mean weight of male medalists is 79.32kg, while that of non-medalists is 75.02kg with a significant p-value. Thus, from these two-sample t-test for male athletes age, height, and weight, we conclude that the average height and weight of athletes who earned a medal signficantly differs from those who did not earn a medal. In this case, the average height and weight is higher for medalists, such that male medalists are taller and heavier than non-medalists. Age does not significantly differ between male medalists and non-medalists. 


```{r t-test, echo=FALSE, include = TRUE}
win.lose = c('Won a medal', "Did not win a medal")
# two-sample t-test between age/height/weight of winner and age of losers

# AGE
# Females
# t-test
t.age.F = t.test(F.Winner$Age, F.Loser$Age, alternative = "two.sided", var.equal = FALSE)
t.age.F
# aggregate means of age for females
means.af <- aggregate(Age ~ Medal, summer_F, mean)
means.af$Age = round(means.af$Age, 3)
# boxplot
ggplot(data=summer_F, aes(x= Medal, y=Age, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Age (years)")+
  geom_text(data = means.af, aes(label = Age, y = Age + 1.2))+
  ggtitle("Age of Female Athletes")+ scale_x_discrete(labels=win.lose)

# Males
t.age.M = t.test(M.Winner$Age, M.Loser$Age, alternative = "two.sided", var.equal = FALSE)
t.age.M
means.am <- aggregate(Age ~ Medal, summer_M, mean)
means.am$Age = round(means.am$Age, 3)
# boxplot
ggplot(data=summer_M, aes(x= Medal, y=Age, fill=Medal))+
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Age (years)")+
  geom_text(data = means.am, aes(label = Age, y = Age + 1))+
  ggtitle("Age of Male Athletes")+ scale_x_discrete(labels=win.lose)




# HEIGHT
# Females
t.height.F = t.test(F.Winner$Height, F.Loser$Height, alternative = "two.sided", var.equal = FALSE)
t.height.F
# aggregate means of Height
means.hf <- aggregate(Height ~ Medal, summer_F, mean)
means.hf$Height = round(means.hf$Height, 2)
# boxplot
ggplot(data=summer_F, aes(x= Medal, y=Height, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Height (cm)")+
  geom_text(data = means.hf, aes(label = Height, y = Height + 2.3))+
  ggtitle("Height of Female Athletes")+ scale_x_discrete(labels=win.lose)

# Males
t.height.M = t.test(M.Winner$Height, M.Loser$Height, alternative = "two.sided", var.equal = FALSE)
t.height.M
# aggregate means of Height
means.hm <- aggregate(Height ~ Medal, summer_M, mean)
means.hm$Height = round(means.hm$Height, 2)
# boxplot
ggplot(data=summer_M, aes(x= Medal, y=Height, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+ labs(y="Height (cm)")+
  geom_text(data = means.hm, aes(label = Height, y = Height + 2.3))+
  ggtitle("Height of Male Athletes")+ scale_x_discrete(labels=win.lose)




# WEIGHT
# Females
t.weight.F = t.test(F.Winner$Weight, F.Loser$Weight, alternative = "two.sided", var.equal = FALSE)
t.weight.F
# aggregate means of Weight
means.wf <- aggregate(Weight ~ Medal, summer_F, mean)
means.wf$Weight = round(means.wf$Weight, 2)
# boxplot
ggplot(data=summer_F, aes(x= Medal, y=Weight, fill=Medal)) + geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+ labs(y="Weight (kg)")+
  geom_text(data = means.wf, aes(label = Weight, y = Weight + 2.5))+
  ggtitle("Weight of Female Athletes")+ scale_x_discrete(labels=win.lose)

# Males
t.weight.M = t.test(M.Winner$Weight, M.Loser$Weight, alternative = "two.sided", var.equal = FALSE)
t.weight.M
# aggregate means of Weight
means.wm <- aggregate(Weight ~ Medal, summer_M, mean)
means.wm$Weight = round(means.wm$Weight, 2)
# boxplot
ggplot(data=summer_M, aes(x= Medal, y=Weight, fill=Medal))+ geom_boxplot()+ 
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Weight (kg)")+
  geom_text(data = means.wm, aes(label = Weight, y = Weight + 3))+
  ggtitle("Weight of Male Athletes")+ scale_x_discrete(labels=win.lose)
```


## 3.2 Principle Component Analysis

In order to further confirm which variables to include in the regression analysis, we performed Principle Component Analysis. Plots show us, once again, that height and weight are highly correlated. Age is almost orthogonal to these two variables. Thus, in the regression analysis we will include age and either height or weight, not both, to avoid multicollinearity. 

```{r Feature Selection, echo=FALSE}
# PCA
library(devtools)
# data with just Age, height weight for females
age_height_weight_F = summer_F[,4:6]

pr.f =prcomp(age_height_weight_F, scale =TRUE)
summary(pr.f)
pr.f$rotation
g.f = ggbiplot::ggbiplot(pr.f, obs.scale = 1, var.scale = 1, alpha=0.2)
g.f$layers <- c(g.f$layers, g.f$layers[[1]])
g.f + ggtitle('PCA of Female Age, Height, & Weight')


# Males PCA
# data with just Age, height weight for males
age_height_weight_M = summer_M[,4:6]

pr.m =prcomp(age_height_weight_M, scale =TRUE)
summary(pr.m)
pr.m$rotation
g.m = ggbiplot::ggbiplot(pr.m, obs.scale = 1, var.scale = 1, alpha=0.2)
g.m$layers <- c(g.m$layers, g.m$layers[[1]])
g.m + ggtitle('PCA of Male Age, Height, & Weight')

```

## 3.3 Logistic Regression

In order to evaluate the extent to which age, height, and weight determine whether an athlete wins an olympic medal, we will perform multiple-Logisitic Regressions. This method was chosen because the dependent variable, 'Medal' is categorical: 'Won a medal', or 'Did not win a medal'. The independent variables include Age and Weight. Height was not included due to its strong correlation with Weight. 

According to the results, in the female Logistic Regression, age and weight have significant p-values (<0.05).As female age increases by one unit, log odds of winning a medal increases by 0.015. As female weight, and therefore height, increases by one unit, log odds of winning a medal increases by 0.031. These results align with our t-tests for female athletes. 

The male logistic regression yeilds similar results to that of females, however, the coefficient for Age reveals a negative relationship with winning a medal. As male age increases by one unit, log odds of winning a medal decreases by 0.004. 
As male weight, and thus height, increases by one unit, log odds of winning a medal increases by 0.021. 

```{r Regression, include=FALSE}
#HAVE TO CHANGE aWinner back to WINNER for Regressions
# change aWinner back to 'winner'
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[summer_w_NAs$Medal == 'aWinner'] <- 'Winner'
# make sure Medal is as factor
summer_w_NAs$Medal = as.factor(summer_w_NAs$Medal)

summer_F.w = summer_w_NAs[summer_w_NAs$Sex == 'F',]

# Logistic regression F
SummerLogit.f <- glm(Medal ~ Age + Weight, data = summer_F.w, family = "binomial")
summary(SummerLogit.f)
SummerLogit.f

library(faraway)
vif(SummerLogit.f)



# Logistic regression M
summer_M.w = summer_w_NAs[summer_w_NAs$Sex == 'M',]
head(summer_M)
SummerLogit.m <- glm(Medal ~ Age + Weight, data = summer_M, family = "binomial")
summary(SummerLogit.m)


vif(SummerLogit.m)

# output
library(stargazer)
stargazer(SummerLogit.f, SummerLogit.m, out='ahw.htm')
```

### 3.3.1 Testing the model

VIF values for each of these models are around 7, which is below the general threshold of 10. In the female model, the Area under the curve is 0.6243, indicating this is not a great classifier. On top of that, this model produces a McFadden value of 2.24%, quite a low value. In the male model, the ROC AOC score is 0.577, and the McFadden value is 1.38%. Again, these values indicate this is not a good model in predicting medals won. 


```{r Testing glm, include=FALSE}
# AIC with just using weight is higher than with height or than with height instead of weight

# FEMALES
# ROC
loadPkg("pROC")
prob_f_glm = predict(SummerLogit.f, type = c("response"))
summer_F.w$prob_f_glm=prob_f_glm
h <- roc(Medal~prob_f_glm, data=summer_F)
auc(h) # area-under-curve prefer 0.8 or higher.
plot(h)

# McFadden
loadPkg("pscl")
Logitpr2_f = pR2(SummerLogit.f)
Logitpr2_f

# MALES
# ROC
prob_m_glm = predict(SummerLogit.m, type = c("response"))
summer_M$prob_m_glm=prob_m_glm
g_m <- roc(Medal~prob_m_glm, data= summer_M)
auc(g_m)
plot(g_m)

# McFadden
loadPkg("pscl")
Logitpr2_m = pR2(SummerLogit.m)
Logitpr2_m
```

## 3.4 Examining Age, Height and Weight, by sport

Average Age, Height, Weight by sport tables for males and females are presented. These graphs help us depict which sports may be outliers in each of these categoreis. From these tables, we have chosen two case studies: Gymnastics and Weightlifting. Gymnastics is on the low-end, if not the lowest, in average Age, Height, and Weight for both males and females. Weightlifting was chosen out of interest after observing their position in Height, which is on the low-end, in contrast to their average Weight, on the higher-end (for both males and females). 

```{r Averages by Sport, echo=FALSE}
# FEMALE
# table of average age, height weight by sport
a_f = aggregate(summer_F[,4:6],by=list(summer_F$Sport), mean)
a_age_f = a_f[order(a_f$Age),]
a_height_f = a_f[order(a_f$Height),]
a_weight_f = a_f[order(a_f$Weight),]


# plot F mean age by sport
library(ggplot2)
ggplot(a_f, aes(x = reorder(Group.1, Age, FUN = median), y = Age)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab('Mean Age (years)') + xlab('') + ggtitle('Mean Age of Female Olympic Athletes by Sport')+
  theme(plot.title = element_text(color="deeppink2", size=14, face="bold"),
        axis.title.y = element_text(color="black", face='bold'))

# plot f meab height by sport
ggplot(a_f, aes(x = reorder(Group.1, Height, FUN = median), y = Height)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab('Mean Height (cm)') + xlab('') + ggtitle('Mean Height of Female Olympic Athletes by Sport')+
    theme(plot.title = element_text(color="deeppink2", size=14, face="bold"),
        axis.title.y = element_text(color="black", face='bold'))

# plot f mean weight by sport
ggplot(a_f, aes(x = reorder(Group.1, Weight, FUN = median), y = Weight)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab('Mean Weight (kg)') + xlab('') + ggtitle('Mean Weight of Female Olympic Athletes by Sport')+
    theme(plot.title = element_text(color="deeppink2", size=14, face="bold"),
        axis.title.y = element_text(color="black", face='bold'))



# MALE
a_m = aggregate(summer_M[,4:6],by=list(summer_M$Sport), mean)
a_age_m = a_m[order(a_m$Age),]
a_height_m = a_m[order(a_m$Height),]
a_weight_m = a_m[order(a_m$Weight),]


# plot M mean age by sport
library(ggplot2)
ggplot(a_m, aes(x = reorder(Group.1, Age, FUN = median), y = Age)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab('Mean Age (years)') + xlab('') + ggtitle('Mean Age of Male Olympic Athletes by Sport')+
  theme(plot.title = element_text(color="royalblue", size=14, face="bold"),
        axis.title.y = element_text(color="black", face='bold'))

# plot M mean height by sport
ggplot(a_m, aes(x = reorder(Group.1, Height, FUN = median), y = Height)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab('Mean Height (cm)') + xlab('') + ggtitle('Mean Height of Male Olympic Athletes by Sport')+
    theme(plot.title = element_text(color="royalblue", size=14, face="bold"),
        axis.title.y = element_text(color="black", face='bold'))

# plot M mean weight by sport
ggplot(a_m, aes(x = reorder(Group.1, Weight, FUN = median), y = Weight)) + 
  geom_boxplot() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  ylab('Mean Weight (kg)') + xlab('') + ggtitle('Mean Weight of Male Olympic Athletes by Sport')+
    theme(plot.title = element_text(color="royalblue", size=14, face="bold"),
        axis.title.y = element_text(color="black", face='bold'))

```


## 3.5 Case Study I: Gymnastics


Gymnastics is one of the most popular Olympic Sports to watch. As we have seen in our graphs, and as is common knowledge, gymnasts are generally younger, shorter, and lighter than most other athletes.Thus, we would like to determine whether these independent variables play a significant role in an gymnasts' chance of earning an olympic medal.

```{r Subset Gymnastics, include=FALSE}
# make it back to aWinner
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Winner'] <- 'aWinner'
summer_w_NAs$Medal = as.factor(summer_w_NAs$Medal)
head(summer_w_NAs)

# subset just gymnasts
gymnastics = summer_w_NAs[summer_w_NAs$Sport == 'Gymnastics',]

# separate males and females
gym_f = gymnastics[gymnastics$Sex =='F',]
gym_m = gymnastics[gymnastics$Sex =='M',]

# female win/lose
gym_f.win = gym_f[gym_f$Medal == "aWinner",]
gym_f.lose = gym_f[gym_f$Medal == "Loser",]

# male win/lose
gym_m.win = gym_m[gym_m$Medal == "aWinner",]
gym_m.lose = gym_m[gym_m$Medal == "Loser",]

```


### 3.5.1 Does Age, Height, Weight differ between Gymnast medalists and non-medalists?

In a similar fashion to our previous analysis of all athletes, we would like to determine whether medlists and non-medalists significantly vary in their average age, height, or weight. We performed two-sample t-tests in the same manner. 

#### Age

The average age female gymnasts is 18.72, meanwhile, that of all other female olympic athletes is 24.47. According to the t-test results, the age of female gymnast medalists significantly differs from that of gymnast non-medalists. As shown on the box-plot, the average gymnast medalist is slightly older than the average gymnast non-medalist. 

The average age of male gymnasts is 23.79, while that of all other athletes is 25.90. Clearly, this is not as great of a difference compared to that of females. In the t-test between male gymnast medalists and non-medalists, the p-value much greater that 0.05, thus we cannot reject the null hypothesis and conclude that the average age does not differ between the two groups. 

From these results, we can infer that age plays a bigger factor in women's gymnastics than it does in men's gymnastics. 

```{r Gymnastics Age, include=FALSE}
# AGE
# Females
# t-test
gym.t.age.F = t.test(gym_f.win$Age, gym_f.lose$Age, alternative = "two.sided", var.equal = FALSE)
gym.t.age.F
# aggregate means of age for females
gym.means.af <- aggregate(Age ~ Medal, gym_f, mean)
gym.means.af$Age = round(gym.means.af$Age, 2)
# boxplot
ggplot(data=gym_f, aes(x= Medal, y=Age, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Age (years)")+
  geom_text(data = gym.means.af, aes(label = Age, y = Age + 0.5))+
  ggtitle("Age of Female Gymnasts") + scale_x_discrete(labels=win.lose)

# Age of females and rest of population??
mean(gym_f$Age)
no_gym_F = summer_F[summer_F$Sport != "Gymnastics",]
mean(no_gym_F$Age)

# Males
# t-test
gym.t.age.M = t.test(gym_m.win$Age, gym_m.lose$Age, alternative = "two.sided", var.equal = FALSE)
gym.t.age.M
# aggregate means of age for females
gym.means.am <- aggregate(Age ~ Medal, gym_m, mean)
gym.means.am$Age = round(gym.means.am$Age, 2)
# boxplot
ggplot(data=gym_m, aes(x= Medal, y=Age, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c('gold','gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Age (years)")+
  geom_text(data = gym.means.am, aes(label = Age, y = Age + 1))+
  ggtitle("Age of Male Gymnasts")+ scale_x_discrete(labels=win.lose)

# Age of males and rest of population
mean(gym_m$Age) 
no_gym_M = summer_M[summer_M$Sport != "Gymnastics",]
mean(no_gym_M$Age)
```

####  Height

The average height female gymnasts is 156.16cm, meanwhile, that of all other female olympic athletes is 170.17cm. According to the t-test results, the height of female gymnast medalists significantly differs from that of gymnast non-medalists. As shown on the box-plot, the average gymnast medalist is shorter than the average gymnast non-medalist. 

The average height of male gymnasts is 167.61cm, while that of all other athletes is 180.21cm.According to the t-test results, the height of male gymnast medalists significantly differs from that of gymnast non-medalists. As seen on the box-plot, the average male gymnast medalist is shorter than the average male gymnast non-medalist.

From these results, we can infer that height plays a significant role in both men and women's gymnastics. It seems that shorter gymnasts perform better. 


```{r Gymnastics Height, echo=FALSE}
# Females
gym.t.height.F = t.test(gym_f.win$Height, gym_f.lose$Height, alternative = "two.sided", var.equal = FALSE)
gym.t.height.F
# aggregate means of Height
gym.means.hf <- aggregate(Height ~ Medal, gym_f, mean)
gym.means.hf$Height = round(gym.means.hf$Height, 2)
# boxplot
ggplot(data=gym_f, aes(x= Medal, y=Height, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Height (cm)")+
  geom_text(data = gym.means.hf, aes(label = Height, y = Height + 3))+
  ggtitle("Height of Female Gymnasts") + scale_x_discrete(labels=win.lose)

# Height of females and rest of population??
mean(gym_f$Height)
mean(no_gym_F$Height)

# Males
gym.t.height.M = t.test(gym_m.win$Height, gym_m.lose$Height, alternative = "two.sided", var.equal = FALSE)
gym.t.height.M
# aggregate means of Height
gym.means.hm <- aggregate(Height ~ Medal, gym_m, mean)
gym.means.hm$Height = round(gym.means.hm$Height, 2)
# boxplot
ggplot(data=gym_m, aes(x=Medal, y=Height, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Height (cm)")+
  geom_text(data = gym.means.hm, aes(label = Height, y = Height + 2.3))+
  ggtitle("Height of Male Gymnasts") + scale_x_discrete(labels=win.lose)

# Height of females and rest of population??
mean(gym_m$Height)
mean(no_gym_M$Height)

```

#### Weight

The results and interpretation of discussed above for height are very similar to that of weight. This is the expected results since height and weight are highly correlated. So, in all, gymnasts who earn medals have significantly different mean weights compared to those who do not win medals. And, as shown on the box-plots below, the mean weight is lighter for medalist. 

```{r Gymnast Weight, echo=FALSE}
# Females
gym.t.weight.F = t.test(gym_f.win$Weight, gym_f.lose$Weight, alternative = "two.sided", var.equal = FALSE)
gym.t.weight.F
# aggregate means of Weight
gym.means.wf <- aggregate(Weight ~ Medal, gym_f, mean)
gym.means.wf$Weight = round(gym.means.wf$Weight, 2)
# boxplot
ggplot(data=gym_f, aes(x= Medal, y=Weight, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Weight (kg)")+
  geom_text(data = gym.means.wf, aes(label = Weight, y = Weight + 2.3))+
  ggtitle("Weight of Female Gymnasts") + scale_x_discrete(labels=win.lose)

# Weight of females and rest of population??
mean(gym_f$Weight)
mean(no_gym_F$Weight)


# Males
gym.t.weight.M = t.test(gym_m.win$Weight, gym_m.lose$Weight, alternative = "two.sided", var.equal = FALSE)
gym.t.weight.M
# aggregate means of Weight
gym.means.wm <- aggregate(Weight ~ Medal, gym_m, mean)
gym.means.wm$Weight = round(gym.means.wm$Weight, 2)
# boxplot
ggplot(data=gym_m, aes(x= Medal, y=Weight, fill=Medal)) + 
  geom_boxplot() +
  scale_fill_manual(values=c("gold", 'gray'))+
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=18, size=2, show.legend =FALSE) + 
  theme(legend.position = "none", axis.title.x = element_blank())+labs(y="Weight (kg)")+
  geom_text(data = gym.means.wm, aes(label = Weight, y = Weight + 2))+
  ggtitle("Weight of Male Gymnasts") + scale_x_discrete(labels=win.lose)

# Weight of females and rest of population??
mean(gym_m$Weight)
mean(no_gym_M$Weight)
```

### 3.5.2 Gymnastics Logistic Regression

According to the Gymnastics Logistic model we have built with Age and Height predicting whether the athlete wins a medal, for females, age and height have significant p-values. For males, only height has a significant p-value. As females increase age by one unit, the log odds of winning a medal increases by 0.05. As female gymnast height increases by one unit, log odds of winning a medal decreases by 0.029. These results align with our t-test results for female gymnasts: the average age of gymnasts medalists is older than that of non-medalists, and gymnast medalists are shorter (and lighter) than non-medalists. In the case of Men's Gymnastics, age does not significantly predict winning a medal. As height (and thus weight) increases by one unit, log odds of winning a medal decreases by 0.06. Again, these results are consistent with our Men's Gymnastics t-tests. Shorter/lighter male gymnasts are more likely to win an olympic medal, as are females.

However, in testing these models, the area under the curve is 0.5786 and 0.5936 for females and males, respectively. Additionally, McFadden values are quite low at 0.73% and 1.26%. From this we conclude that these are not good models of predicting gymnastics olympic medalling. Perhaps with additional independent variables such as, years of training, ethnicity, muscle mass, etc. we would be able to create a better model. 


```{r Gymnastics Regression, include=FALSE}
# Change it back to 'winner'
# change aWinner back to 'winner'
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[summer_w_NAs$Medal == 'aWinner'] <- 'Winner'
# make sure Medal is as factor
summer_w_NAs$Medal = as.factor(summer_w_NAs$Medal)

# subset just gymnasts from 'winner'
gymnastics.w = summer_w_NAs[summer_w_NAs$Sport == 'Gymnastics',]

# separate males and females
gym_f.w = gymnastics.w[gymnastics.w$Sex =='F',]
gym_m.w = gymnastics.w[gymnastics.w$Sex =='M',]

head(gym_f.w)

# Logistic Regression Female Gymnasts
gym_glm_f = glm(Medal~Age+Height, data=gym_f.w, family = "binomial")
summary(gym_glm_f)

# vif F-Gymnast
library(faraway)
vif(gym_glm_f)

# testing the model
# ROC
loadPkg("pROC")
prob_f_gym = predict(gym_glm_f, type = c("response"))
gym_f.w$prob_f_gym=prob_f_gym
h.gf <- roc(Medal~prob_f_gym, data=gym_f.w)
auc(h.gf) # area-under-curve prefer 0.8 or higher.

# McFadden
loadPkg("pscl")
Logitpr2_gym_f = pR2(gym_glm_f)
Logitpr2_gym_f



# Logistic Regression Male Gymnasts
gym_glm_m = glm(Medal~Age+Height, data=gym_m.w, family = "binomial")
summary(gym_glm_m)

# vif M-Gymnast
vif(gym_glm_m)


# testing the model
# ROC
prob_m_gym = predict(gym_glm_m, type = c("response"))
gym_m.w$prob_m_gym=prob_m_gym
h.gm <- roc(Medal~prob_m_gym, data=gym_m.w)
auc(h.gm) # area-under-curve prefer 0.8 or higher.

# McFadden
Logitpr2_gym_m = pR2(gym_glm_m)
Logitpr2_gym_m

library(stargazer)
stargazer(gym_glm_f, gym_glm_m, out='ahw_gym.htm')
```


### 3.6 Case study II: Weightlifting

Our next case study, weightlifting was interesting because on our boxplot of average height and weight across all sports, for both males and females, weightlifters were on the lower-end for height and higher-end for weight when compared to all other sports. The graph of Weight vs. Height printed below depicts the relationship between those of weightlifters in red and all other athletes in gray. Clearly, the relationship is not as linear when compared to other athletes. 

```{r Subset weightlifting, include=FALSE}
# change it back to aWinner
# THIS IS VERY IMPORTANT PART OF THE CODE
summer_w_NAs <- subset(athlete_events, Season == 'Summer')
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[is.na(summer_w_NAs$Medal)] <- "Loser"

# made it 'a' in the beginning so that in the boxplots it is the one on the left
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Bronze'] <- 'aWinner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Silver'] <- 'aWinner'
summer_w_NAs$Medal[summer_w_NAs$Medal == 'Gold'] <- 'aWinner'

# make sure Medal is as factor
summer_w_NAs$Medal = as.factor(summer_w_NAs$Medal)

# subset weightlifting
weightlifting = summer_w_NAs[summer_w_NAs$Sport == 'Weightlifting',]
weightlifting.win = weightlifting[weightlifting$Medal=='aWinner',]
weight_f = weightlifting[weightlifting$Sex =='F',]
weight_m = weightlifting[weightlifting$Sex =='M',]

weight_f.win = weight_f[weight_f$Medal == "aWinner",]
weight_f.lose = weight_f[weight_f$Medal == "Loser",]

weight_m.win = weight_m[weight_m$Medal == "aWinner",]
weight_m.lose = weight_m[weight_m$Medal == "Loser",]
```

 

```{r weight t-test, echo=FALSE, include=TRUE}
# take out weightlifting
no_weightlift = summer_w_NAs[summer_w_NAs$Sport != 'Weightlifting',]

# plot weightlifters height and weight
# ggplot(weightlifting, aes(x=Weight, y=Height,, color=Sex)) +
#  geom_point(size=0.5)+
#  geom_smooth(method='auto')+
#  ggtitle("Weight vs. Height for Weightlifters")+
#  xlab('Weight(kg)')+ ylab("Height(cm)")+ xlim(0,175)+
#  scale_color_manual(values=c('deeppink2','royalblue'))

# plot winners height vs. weight
#ggplot(weightlifting.win, aes(x=Weight, y=Height,, color=Sex)) +
#  geom_point(size=0.5)+
#  geom_smooth(method='auto')+
#  ggtitle("Weight vs. Height for Weightlifters")+
#  xlab('Weight(kg)')+ ylab("Height(cm)")+ xlim(0,175)+
#  scale_color_manual(values=c('deeppink2','royalblue'))

# create dataframe that marks all other sports as "other" and keeps weightlifting
new_w = summer_w_NAs
new_w$Sport = as.character(new_w$Sport)
new_w$Sport[new_w$Sport!='Weightlifting']<- 'All other sports'

# plot height vs. weight for all other sports and weightlifting to compare
ggplot(new_w, aes(x=Weight, y=Height,, color=Sport)) +
  geom_point(size=0.3)+
  geom_smooth(method='auto')+
  ggtitle("Weight vs. Height of All Athletes and Weightlifters")+
  xlab('Weight(kg)')+ ylab("Height(cm)")+ xlim(0,200)+
  scale_color_manual(values=c('darkgray','red'))
```


#### 3.6.1 Weightliftiing T-Tests

In a similar fashion to our other case study and previous analysis of all athletes, we have performed t-tests to evaluate the difference between weightlifting olympic medalists and non-medalists age, height, and weight. Our results reveal that the average age, height, and weight of female weightlifting medalists does not significantly differ from that of non-medalists. Males have similar results, however the male weightlifting medalists have a significant p-value, thus significantly different mean for Weight compared to non-medalists. Male weightlifting medalists are on average 82.91kg, while non-medalists average 79.77kg. So, it may be beneficial for male weightlifters to be heavier if they want to win a medal. 

```{r Weightlifting t-test, include=FALSE}
# AGE: 
# Females
weight.t.age.F = t.test(weight_f.win$Age, weight_f.lose$Age, alternative = "two.sided", var.equal = FALSE)
weight.t.age.F

# males
weight.t.age.M = t.test(weight_m.win$Age, weight_m.lose$Age, alternative = "two.sided", var.equal = FALSE)
weight.t.age.M


# HEIGHT
# females
weight.t.height.F = t.test(weight_f.win$Height, weight_f.lose$Height, alternative = "two.sided", var.equal = FALSE)
weight.t.height.F

# males
weight.t.height.M = t.test(weight_m.win$Height, weight_m.lose$Height, alternative = "two.sided", var.equal = FALSE)
weight.t.height.M



# WEIGHT
# females
weight.t.weight.F = t.test(weight_f.win$Weight, weight_f.lose$Weight, alternative = "two.sided", var.equal = FALSE)
weight.t.weight.F

# males
weight.t.weight.M = t.test(weight_m.win$Weight, weight_m.lose$Weight, alternative = "two.sided", var.equal = FALSE)
weight.t.weight.M
```

#### 3.6.2 Weightliftiing Logistic Regressions

In our logistic models for weightlifters, we have included Age, Height, and Weight. In this case, because height and weight are less highly correlated, we have included both variables in the model. The results for female weightlifters reveal that age, height, and weight are not signifcant predictors of winning a weightlifting medal. Conversely, for males, both height and weight had significant p-values. As male weightlifters' height increases by one unit, log odds of winning a medal decrease by 0.033. As male weightlifters' weight increases by one unit, log odds of winning a medal increases by 0.016. This means that shorter, heavier male weightlifters are more likely to win an olympic medal. This is quite interesting consdiering it differs from our results of all altheltes and Case Study I. This proves that age, height, and weight affects athletes of all sports differently. Again, these models are not good according to the AOC and McFadden values, so our results cannot be interpreted as strong conclusions.


```{r Weightlifting Regression, include=FALSE}
# change aWinner back to 'winner'for regressions
summer_w_NAs$Medal <- as.character(summer_w_NAs$Medal)
summer_w_NAs$Medal[summer_w_NAs$Medal == 'aWinner'] <- 'Winner'
# make sure Medal is as factor
summer_w_NAs$Medal = as.factor(summer_w_NAs$Medal)

# subset just gymnasts from 'winner'
weightlift.w = summer_w_NAs[summer_w_NAs$Sport == 'Weightlifting',]

# separate males and females
weight_f.w = weightlift.w[weightlift.w$Sex =='F',]
weight_m.w = weightlift.w[weightlift.w$Sex =='M',]


# Logistic Regression Female Weightlifters

weight_glm.f = glm(Medal~Age+Height+Weight, data=weight_f.w, family = "binomial")
summary(weight_glm.f)

# vif F-Gymnast
library(faraway)
vif(weight_glm.f)

# testing the model
# ROC
loadPkg("pROC")
prob_f_weight = predict(weight_glm.f, type = c("response"))
#weight_f.w$prob_f_weight=prob_f_weight
#h.wf <- roc(Medal~prob_f_weight, data=weight_f.w)
#auc(h.wf) # area-under-curve prefer 0.8 or higher.

# McFadden
loadPkg("pscl")
Logitpr2_weight_f = pR2(weight_glm.f)
Logitpr2_weight_f



# Logistic Regression Male weightlifters
weight_glm_m = glm(Medal~Age+Height+Weight, data=weight_m.w, family = "binomial")
summary(weight_glm_m)

# vif M-weightnast
vif(weight_glm_m)


# testing the model
# ROC
prob_m_weight = predict(weight_glm_m, type = c("response"))
#weight_m.w$prob_m_weight=prob_m_weight
#h.wm <- roc(Medal~prob_m_weight, data=weight_m.w)
#auc(h.wm) # area-under-curve prefer 0.8 or higher.

# McFadden
Logitpr2_weight_m = pR2(weight_glm_m)
Logitpr2_weight_m

library(stargazer)
stargazer(weight_glm.f, weight_glm_m, out='ahw_weight.htm')
```

